<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OTUS homework: Асинхронная программа для пакетной обработки команд</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OTUS homework
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Contains homeworks for course Professional C++ programmer</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Асинхронная программа для пакетной обработки команд </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Основных целей две, нужно переработать код из задания про пакетную обработку команд (Задание 7) таким образом, чтобы:</p><ol type="1">
<li>команды обрабатывались многопоточно</li>
<li>ввод данных управлялся внешним кодом. </li>
</ol>
<h1><a class="anchor" id="autotoc_md27"></a>
Многопоточная обработка команд</h1>
<p>При старте программы должно быть создано в дополнение к существующему основному потоку ещё три дополнительных. Дадим им условные имена:</p><ul>
<li>main – основной поток (в пользовательском приложении)</li>
<li>log – поток для вывода данных в консоль</li>
<li>file1 – первый поток для вывода в файл</li>
<li>file2 – второй поток для вывода в файл</li>
</ul>
<p>Основная логика обработки меняется таким образом, что блок команд после своего формирования должен быть отправлен в консоль (потоком log) и сразу в файл (одним из потоков file1 или file2). При этом отправка блока в файл распределяется между файловыми потоками. Можно напрямую отправлять, например, чётные команды через поток file1, а нечётные – через file2. Но лучшим решение станет использование единой очереди команд, которую будут обрабатывать оба файловых потока одновременно. Следует обратить внимание на недостаточную точность часов для формирования уникального имени. Необходимо, сохранив timestamp в имени, добавить дополнительный постфикс, который будет гарантированно отличаться у файловых потоков. </p>
<h1><a class="anchor" id="autotoc_md28"></a>
Управление вводом данных внешним кодом</h1>
<p>В рамках этой части работы нужно выполнить код в виде библиотеки с описанным в файле <a class="el" href="async_8h.html">async.h</a> внешним интерфейсом. Инициатором обмена будет выступать внешний код. Вместо привычной точки входа в приложение <a class="el" href="01__home__work_2main_8cpp.html#a2c3f6775325c30275d11c6abee2db6a0">main()</a> будут три внешних функции <a class="el" href="namespaceasync.html#a003d1a6899dca20ddcbff67a6abfb491">connect()</a>, <a class="el" href="namespaceasync.html#aa1b54e89e951488a8dd79e720f3d8f8b">receive()</a> и <a class="el" href="namespaceasync.html#a04233bf9bec326f7bcb4e1a9d5b8ee9d">disconnect()</a>. Порядок вызовов следующий:</p><ul>
<li>вызывается <a class="el" href="namespaceasync.html#a003d1a6899dca20ddcbff67a6abfb491">connect()</a> с передачей размера блока команд, сохраняется значение возврата. Значение никак не интерпретируется вызывающим кодом и служит только в качестве контекста для функций <a class="el" href="namespaceasync.html#aa1b54e89e951488a8dd79e720f3d8f8b">receive()</a> и <a class="el" href="namespaceasync.html#a04233bf9bec326f7bcb4e1a9d5b8ee9d">disconnect()</a>.</li>
<li>вызывается <a class="el" href="namespaceasync.html#aa1b54e89e951488a8dd79e720f3d8f8b">receive()</a> c передачей указателя на начало буфера, его размера, а также контекста. Вызов повторяемый – вызывающий код может использовать его для передачи нескольких команд подряд.</li>
<li>вызывается <a class="el" href="namespaceasync.html#a04233bf9bec326f7bcb4e1a9d5b8ee9d">disconnect()</a> с передачей контекста. Вызов разрушает контекст полностью. С точки зрения логики обработки команд этот вызов считается завершением текущего блока команд.</li>
</ul>
<p>Необходимо реализовать эти функции так, чтобы сохранить прежнюю функционально проекта. Реализация должна допускать множественные вызовы <a class="el" href="namespaceasync.html#a003d1a6899dca20ddcbff67a6abfb491">connect()</a>. Вызовы <a class="el" href="namespaceasync.html#aa1b54e89e951488a8dd79e720f3d8f8b">receive()</a> с разными контекстами не должны мешать друг другу. Вызовы могут осуществляться из разных потоков, однако вызовы с одинаковым контекстом всегда выполняются из одного и того же потока. Опционально реализовать возможность вызывать все функции из любых потоков. </p>
<h1><a class="anchor" id="autotoc_md29"></a>
Требования к реализации</h1>
<p>Результатом работы должна стать библиотека, устанавливаемая по стандартному пути. Библиотека должна называться libasync.so и находиться в пакете async. Для проверки работоспособности следует реализовать также исполняемый файл, который использует библиотеку с демонстрацией всех вызовов. Исполняемый файл также должен быть добавлен в пакет. </p>
<h1><a class="anchor" id="autotoc_md30"></a>
Проверка</h1>
<p>Задание считается выполненным успешно, если после установки пакета, линковки с тестовым кодом (пример в main.cpp) и запуска с тестовыми данными вывод соответствует описанию Задания</p><ol type="1">
<li>Данные подаются порциями в разных контекстах в большом объёме без пауз. </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
